#!/bin/bash

# InvocaciÃ³n: LOGEP COMMAND MESSAGE ERRLVL
# E.g.: LOGEP $0 'Error en el archivo' 'ERR'

if [ -z $DIRLOG ] ;
then
    echo "No existe DIRLOG"
fi

WHERE=`echo $1 | rev | cut -d/ -f1 | rev | cut -d. -f1`
LOGFILE="$DIRLOG/$WHERE.log" # Usa el nombre del comando como nombre de archivo

WHY=$3
WHO=$USER
WHEN=`date "+%Y/%m/%d %T"`
WHAT=$2

if [ ! -f $LOGFILE ];
then
    touch $LOGFILE
fi

LOGLINE=$(echo $WHO $WHEN $WHERE $WHAT $WHY)
FILESIZE=$(wc -c $LOGFILE | cut -d' ' -f1)

if [ $FILESIZE -ge $LOGSIZE ];
then
    TMPFILE="templog.log"
    tail -n100 $LOGFILE >> $TMPFILE
    echo "Log Excedido." >> $TMPFILE
    mv $TMPFILE $LOGFILE
fi

echo "$WHO $WHEN $WHERE $WHAT $WHY" >> $LOGFILE
